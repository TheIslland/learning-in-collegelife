# 红黑树

## 概念

* 红黑树（Red Black Tree） 是一种自平衡二叉查找树，是在[计算机](https://baike.baidu.com/item/%E8%AE%A1%E7%AE%97%E6%9C%BA)科学中用到的一种[数据结构](https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1450)，典型的用途是实现[关联数组](https://baike.baidu.com/item/%E5%85%B3%E8%81%94%E6%95%B0%E7%BB%84/3317025)。

  它是在1972年由Rudolf Bayer发明的，当时被称为平衡二叉B树（symmetric binary B-trees）。后来，在1978年被 Leo J. Guibas 和 Robert Sedgewick 修改为如今的“红黑树”。

  红黑树和AVL树类似，都是在进行插入和删除操作时通过特定操作保持二叉查找树的平衡，从而获得较高的查找性能。

  它虽然是复杂的，但它的最坏情况运行时间也是非常良好的，并且在实践中是高效的： 它可以在O(log n)时间内做查找，插入和删除，这里的n 是树中元素的数目。

## 五个条件

* 红黑树是每个节点都带有颜色属性的二叉查找树，颜色或红色或黑色。在二叉查找树强制一般要求以外，对于任何有效的红黑树我们增加了如下的额外要求:

  * 性质1. 节点是红色或黑色。
  * 性质2. 根节点是黑色。
  * 性质3 每个叶节点（NIL节点，空节点）是黑色的。
  * 性质4 每个红色节点的两个子节点都是黑色。(从每个叶子到根的所有路径上不能有两个连续的红色节点)
  * 性质5. 从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点。
  * 由４，５条性质可知红黑树中最长路径是最短路径的两倍

  这些约束强制了红黑树的关键性质: 从根到叶子的最长的可能路径不多于最短的可能路径的两倍长。结果是这个树大致上是平衡的。因为操作比如插入、删除和查找某个值的最坏情况时间都要求与树的高度成比例，这个在高度上的理论上限允许红黑树在最坏情况下都是高效的，而不同于普通的二叉查找树。

  要知道为什么这些特性确保了这个结果，注意到性质4导致了路径不能有两个毗连的红色节点就足够了。最短的可能路径都是黑色节点，最长的可能路径有交替的红色和黑色节点。因为根据性质5所有最长的路径都有相同数目的黑色节点，这就表明了没有路径能多于任何其他路径的两倍长。

  在很多树[数据结构](https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84)的表示中，一个节点有可能只有一个子节点，而[叶子节点](https://baike.baidu.com/item/%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9)不包含数据。用这种范例表示红黑树是可能的，但是这会改变一些属性并使算法复杂。为此，本文中我们使用 "nil 叶子" 或"空(null)叶子"，如上图所示，它不包含数据而只充当树在此结束的指示。这些节点在绘图中经常被省略，导致了这些树好象同上述原则相矛盾，而实际上不是这样。与此有关的结论是所有节点都有两个子节点，尽管其中的一个或两个可能是空叶子。

## 调整策略

* 插入调整站在祖父节点看
* 删除调整站在父节点看
* 插入和删除的情况处理一共有五种

## 插入调整的情况

为了去掉两个连续的红色结点

站在祖父结点看父亲和儿子是否冲突（每个插入的结点都是红色的）

### 情况一

![](/home/g/%E5%9B%BE%E7%89%87/2019-02-17%2014-53-52%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png)

要回溯到祖父结点进行判断是否冲突 要维护红黑树的性质（保证每条路径上的黑色结点数量相同）

发生这种情况的冲突当前结点一定是黑色的

把父节点改为黑色把祖父结点改为红色

**处理方法：1和20修改成黑色，15修改成红色（红色上顶）**

### 情况二

![](/home/g/%E5%9B%BE%E7%89%87/2019-02-17%2014-56-59%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png)

黑红红叫红色下沉

红黑黑叫红色上顶

站在祖父结点看右儿子是黑色不是红色

旋转前黑色结点个数保证旋转后黑色结点个数相同

保证可以为路径上提供黑色结点个数相同

**处理方法：大右（左）旋，20调整成红色，15调整成黑色（调整策略和AVL树是相同的）**

**LL，RR，RL，LR型调整和AVL树相同调整后再调色**

## 删除调整的情况

为了去掉双重黑

兄弟结点红色在左边或者在右边 左边大右旋右边大左旋

兄弟结点黑色 孩子都红 都黑 黑红

共6种情况

六种情况度为0的黑色或者红色，度为1的黑色或者红色，度为2的黑色或者红色

数值是为了保证排序信息的 颜色是为了保证平衡性的

| 度   | 2            | 2            | 1                     | 1                                        | 0                                                            | 0        |
| ---- | ------------ | ------------ | --------------------- | ---------------------------------------- | ------------------------------------------------------------ | -------- |
| 颜色 | 黑           | 红           | 黑                    | 红                                       | 黑                                                           | 红       |
|      | 直接正常删除 | 直接正常删除 | 双重黑NIL把原节点删除 | 父亲儿子均为黑色不会影响平衡直接删除即可 | 父节点下一定有两个子孩子将这个结点的虚拟节点变为双重黑色为了去掉双重黑的状态父节点加一重黑兄弟减一重黑 | 直接删除 |

### 情况一

![](/home/g/%E5%9B%BE%E7%89%87/2019-02-17%2015-00-36%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png)

x为双重黑色brother黑色带2个黑色儿子将兄弟结点改为红色父节点加一重黑色，x减一重黑色

**处理方法：brother调整为红色，x减少一重黑色，father增加一重黑色**

### 情况二

![](/home/g/%E5%9B%BE%E7%89%87/2019-02-17%2015-42-04%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png)

RL先小右旋改颜色再按RR型改颜色



**处理方法：brother右（左）旋，51变黑，72变红，攥成处理情况三**

### 情况三

![](/home/g/%E5%9B%BE%E7%89%87/2019-02-17%2015-51-37%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png)

兄弟结点为黑色单一个孩子结点为红色

RR先大左旋把两课子树都改为黑色根节点改为原来的颜色把双重黑的结点减一重黑

**处理方法：father左（右）旋，由于无法确定48的颜色，所以38改为黑色，51改为38的颜色，x减少一重黑色，72改为黑色**

**可以将黑节点染成红色理解为包含该节点的路径黑节点总数减一，红节点染成黑色路径上黑节点总数加一**

